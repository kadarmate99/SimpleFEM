<Window x:Class="SimpleFEM.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SimpleFEM"
        xmlns:vm="clr-namespace:SimpleFEM.UI.ViewModels"
        mc:Ignorable="d"
        Title="SimpleFEM" 
        WindowStartupLocation="CenterScreen"
        Height="600" Width="900"
        d:DesignHeight="450" d:DesignWidth="800" d:FontSize="16">
    
    <Window.InputBindings>
        <KeyBinding Key="Z" Modifiers="Control" Command="{Binding UndoCommand}"/>
        <KeyBinding Key="Y" Modifiers="Control" Command="{Binding RedoCommand}"/>
    </Window.InputBindings>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Menu -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar/Tabs -->
            <RowDefinition Height="*"/>
            <!-- Main Workspace -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <Menu Grid.Row="0"
              Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}">
            <MenuItem Header="_File" Padding="8,-6">
                <MenuItem Header="_Open..."/>
                <MenuItem Header="_Save"/>
                <MenuItem Header="Save _As..."/>
                <Separator/>
                <MenuItem Header="_Exit"/>
            </MenuItem>
            <MenuItem Header="_Edit" Padding="8,-6">
                <MenuItem Header="_Undo"
                          Command="{Binding UndoCommand}"
                          InputGestureText="Ctrl+Z">
                    <MenuItem.Icon>
                        <TextBlock Text="↶" FontSize="16"/>
                    </MenuItem.Icon>                    
                </MenuItem>
                <MenuItem Header="_Redo"
                          Command="{Binding RedoCommand}"
                          InputGestureText="Ctrl+Y">
                    <MenuItem.Icon>
                        <TextBlock Text="↷" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Tools in TabControl -->
        <TabControl Grid.Row="1" Margin="12,4,0,0" Padding="12">
            <TabItem Header="Geometry">
                <StackPanel Orientation="Horizontal" Margin="-7,6">
                    <TextBlock Text="Create:" Style="{StaticResource GroupLabelStyle}"/>
                    <Button 
                        Content="Node" 
                        Command="{Binding SelectToolCommand}"
                        CommandParameter="Node"
                        Style="{StaticResource ToolbarButtonStyle}"/>

                    <Button 
                        Content="Line" 
                        Command="{Binding SelectToolCommand}"
                        CommandParameter="Line"
                        Style="{StaticResource ToolbarButtonStyle}"/>

                    <!-- Vertical Divider -->
                    <Border Width="1" Height="24" Background="#E5E5E5" Margin="8,0,16,0"/>

                    <TextBlock Text="Modify:" Style="{StaticResource GroupLabelStyle}"/>
                    <Button Content="Move" Style="{StaticResource ToolbarButtonStyle}"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="Elements &amp; Supports">
                <StackPanel Orientation="Horizontal" Margin="-7,6">
                    <TextBlock Text="Boundary:" Style="{StaticResource GroupLabelStyle}"/>
                    <Button Content="Point Support" Style="{StaticResource ToolbarButtonStyle}"/>

                    <Border Width="1" Height="24" Background="#E5E5E5" Margin="8,0,16,0"/>

                    <TextBlock Text="Types:" Style="{StaticResource GroupLabelStyle}"/>
                    <Button Content="Truss Element" Style="{StaticResource ToolbarButtonStyle}"/>
                    <Button Content="Beam Element" Style="{StaticResource ToolbarButtonStyle}"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="Analysis">
                <StackPanel Orientation="Horizontal" Margin="-7,6">
                    <Button Content="Run Analysis" 
                            Style="{StaticResource ToolbarButtonStyle}"
                            FontWeight="Bold" />
                    <Button Content="View Results" Style="{StaticResource ToolbarButtonStyle}"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- Canvas -->
        <Border Grid.Row="2" 
                Background="#F9F9F9" 
                BorderBrush="#E0E0E0"
                BorderThickness="0,1,0,0">
            <Grid>
                <Canvas Background="Transparent" 
                        MouseLeftButtonDown="OnCanvasClick"/>

                <ItemsControl ItemsSource="{Binding Lines}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas IsItemsHost="True"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:LineViewModel}">
                            <Line X1="{Binding X1}" Y1="{Binding Y1}"
                                  X2="{Binding X2}" Y2="{Binding Y2}"
                                  Stroke="Gray" StrokeThickness="2"
                                  IsHitTestVisible="False"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <ItemsControl ItemsSource="{Binding Nodes}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas IsItemsHost="True"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Canvas.Left" Value="{Binding X}"/>
                            <Setter Property="Canvas.Top" Value="{Binding Z}"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="-6,-6,0,0" IsHitTestVisible="False">
                                <Ellipse Width="12" Height="12" 
                                         Fill="#3399FF" 
                                         Stroke="White" 
                                         StrokeThickness="2">
                                    <Ellipse.Effect>
                                        <DropShadowEffect ShadowDepth="1" BlurRadius="4" Opacity="0.3"/>
                                    </Ellipse.Effect>
                                </Ellipse>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Padding="10,4">
            <StatusBarItem>
                <TextBlock Text="{Binding ActiveTool.Name, StringFormat='Active Tool: {0}'}" FontWeight="SemiBold"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Nodes.Count, StringFormat='Nodes: {0}'}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Lines.Count, StringFormat='Lines: {0}'}"/>
            </StatusBarItem>
        </StatusBar>

    </Grid>
</Window>